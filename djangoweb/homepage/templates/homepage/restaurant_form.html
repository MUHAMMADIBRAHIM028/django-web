{% extends "homepage/base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4 d-flex justify-content-center">
  <!-- limit width to ~A4 portrait -->
  <div class="card shadow p-4" style="max-width: 700px; width:100%; min-height: 900px;">
    <h3 class="text-center mb-4">{{ title }}</h3>

    <form method="post">
      {% csrf_token %}
      <div class="row">
        <!-- Left column -->
        <div class="col-md-6">
          <div class="mb-2">
            <label class="form-label">Restaurant Name</label>
            <input type="text" name="name" class="form-control form-control-sm"
                   value="{{ form.name.value|default_if_none:'' }}">
          </div>
          <div class="mb-2">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control form-control-sm" rows="3">{{ form.description.value|default_if_none:'' }}</textarea>
          </div>
          <div class="mb-2">
            <label class="form-label">Location</label>
            <input type="text" name="location" id="id_location"
                   class="form-control form-control-sm"
                   value="{{ form.location.value|default_if_none:'' }}">
          </div>
        </div>

        <!-- Right column (Menus) -->
        <div class="col-md-6">
          <label class="form-label">Menus</label>
          <div id="menu-fields">
            <input type="text" name="menus" class="form-control form-control-sm mb-2"
                   placeholder="Menu item">
          </div>
          <button type="button" class="btn btn-outline-primary btn-sm" id="add-menu">+ Add Menu</button>
        </div>
      </div>

         <div class="text-center mt-3">
        <button type="submit" class="btn btn-primary btn-sm">Save</button>
        <a href="{% url 'manage_restaurants' %}" class="btn btn-secondary btn-sm">Back</a>
      </div>
    </form> <!-- form ends immediately after buttons -->

  </div> <!-- end card -->
</div> <!-- end container -->

<!-- JS for dynamic menu fields -->
<script>
document.getElementById('add-menu').addEventListener('click', function () {
  const container = document.getElementById('menu-fields');
  const input = document.createElement('input');
  input.type = 'text';
  input.name = 'menus';
  input.className = 'form-control form-control-sm mb-2';
  input.placeholder = 'Menu item';
  container.appendChild(input);
});
</script>
<script>
function initMap() {
  // Try to parse initial location from input, else use default (Lahore)
  let locationInput = document.getElementById("id_location");
  let coords = locationInput.value.split(",");
  let lat = parseFloat(coords[0]);
  let lng = parseFloat(coords[1]);
  const defaultLocation = (!isNaN(lat) && !isNaN(lng)) 
    ? {lat: lat, lng: lng} 
    : {lat: 31.582045, lng: 74.329376};

  // Map
  //const map = new google.maps.Map(document.getElementById("map"), {
   // center: defaultLocation,
   // zoom: 12,
  //});

  // Marker
  //let marker = new google.maps.Marker({
    //position: defaultLocation,
    //map: map,
   // draggable: true,
  //});

  // Places Autocomplete
  const autocomplete = new google.maps.places.Autocomplete(locationInput);
  //autocomplete.bindTo("bounds", map);

  autocomplete.addListener("place_changed", function () {
    const place = autocomplete.getPlace();
    if (!place.geometry) return;
   // map.setCenter(place.geometry.location);
   // map.setZoom(15);
   // marker.setPosition(place.geometry.location);
  });

  // Update input when marker dragged
 // marker.addListener("dragend", function () {
   // locationInput.value =
   //   marker.getPosition().lat() + "," + marker.getPosition().lng();
  //});

  // Update marker when map clicked
 // map.addListener("click", function (event) {
  //  marker.setPosition(event.latLng);
  //  locationInput.value =
   //   event.latLng.lat() + "," + event.latLng.lng();
 // });
}
</script>

<!-- Google Maps API Key -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCdlxn1ZwrODmbopxCSDi-K-VNPgnbWss&libraries=places&callback=initMap">
</script>
{% endblock %}
